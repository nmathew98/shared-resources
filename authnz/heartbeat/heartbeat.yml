name: 'rollout-heartbeat'
tags: ['${JAVA_ENV}']

setup.kibana:
  host: '${KIBANA_HOST_PORT}'
  username: '${KIBANA_USERNAME}'
  password: '${KIBANA_PASSWORD}'

heartbeat.monitors:
- type: http
  schedule: '@every 30m'
  name: 'Keycloak'
  check.response.status: [302]
  urls:
    - https://${KEYCLOAK_PUBLIC_HOST}

heartbeat.autodiscover:
  providers:
    - type: docker
      templates:
        - condition:
            - or:
              - contains:
                  docker.container.image: authnz
              - contains:
                  docker.container.image: nginx
            - and:
              - or:
                - equals:
                    port: 8080
                - equals:
                    port: 443
          config:
            - type: http
              hosts: ["${data.host}:${data.port}"]
              schedule: "@every 30m"
              timeout: 1s

processors:
  - add_cloud_metadata: ~
  - add_docker_metadata:
      host: "unix:///var/run/docker.sock"

output.elasticsearch:
  hosts: '${ELASTICSEARCH_HOST_PORT}'
  username: '${ELASTIC_USERNAME}'
  password: '${ELASTIC_PASSWORD}'

# Defines if the HTTP endpoint is enabled.
http.enabled: true
http.host: 0.0.0.0
http.port: 5066
